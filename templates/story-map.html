{% extends "base.html" %}

{% block header %}
	<h1>About Story {{story['stories_id']}}</h1>
{% endblock %}

{% block content %}

	<div class="row">
		<div class="col-md-6">
			<h3>About These Places:</h3>
			<p>
			<ul>
			{% for geoname in about_geonames %}
				<li><a href="{{url_for('tag_by_geonames_id',geonames_id=geoname['id'])}}">{{geoname['name']}}, {{geoname['countryCode']}}</a></li>
			{% endfor %}
			</ul>
			</p>
		</div>
		<div class="col-md-6">
			<h3>Mentions These Places:</h3>
			<p>
			<ul>
			{% for geoname in mentioned_geonames %}
				<li><a href="{{url_for('tag_by_geonames_id',geonames_id=geoname['id'])}}">{{geoname['name']}}, {{geoname['countryCode']}}</a></li>
			{% endfor %}
			</ul>
			</p>
		</div>
	</div>

	<div class="row">
		<div class="col-md-12">
			<div id="map"></div>
		</div>
	</div>

	<div class="row">
		<div class="col-md-12">
			<table class="table">
				<tr>
					<th>Id</th>
					<th>Num</th>
					<th>Sentence</th>
					<th>Places</th>
				</tr>
			{% for sentence in story['story_sentences'] %}
				<tr>
					<td>{{sentence['story_sentences_id']}}</td>
					<td>{{sentence['sentence_number']}}</td>
					<td>{{sentence['sentence']}}</td>
					<td>
					{% for geoname in sentence['geonames'] %}
						<a href="{{url_for('tag_by_geonames_id',geonames_id=geoname['id'])}}">{{geoname['name']}}, {{geoname['countryCode']}}</a><br />
					{% endfor %}
					</td>
				</tr>
			{% endfor %}
			</table>
		</div>
	</div>

{% endblock %}

{% block page_scripts %}
	<script type="text/javascript">
	$(function(){
		var map = new L.Map('map');
		// create the tile layer with correct attribution
		var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
		var osmAttrib='Map data Â© <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
		var osmLayer = new L.TileLayer(osmUrl, {minZoom: 2, maxZoom: 14, attribution: osmAttrib});		

		// start the map in South-East England
		map.setView([0,0],2);
		map.addLayer(osmLayer);

		{% for geoname in mentioned_geonames %}
			L.marker([{{geoname['lat']}}, {{geoname['lon']}}]).addTo(map)		
				.bindPopup("{{geoname['name']}}");
		{% endfor %}
	});
	</script>
{% endblock %}